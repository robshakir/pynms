<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title>Getting Started</title> <meta name="description" content="PyangBind is a plugin for Pyang that generates a Python class hierarchy from a YANG data model. The resulting classes can be directly interacted with in Pyth..."> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="http://pynms.io/pyangbind/getting_started"> <link rel="alternate" type="application/rss+xml" title="PyNMS" href="http://pynms.io/feed.xml"> <script src="/assets/js/modernizr.js"></script> </head> <body"> <main class="wrapper"> <header class="site-header"> <a href="#navbar" id="menu-burger" class="menu-burger">Menu <span class="nav-icon"></span> <svg x="0px" y="0px" width="54px" height="54px" viewBox="0 0 54 54"> <circle fill="transparent" stroke="#000000" stroke-width="1" cx="27" cy="27" r="25" stroke-dasharray="157 157" stroke-dashoffset="157"></circle> </svg> </a> <div id="navbar" class="navbar"> <div class="navigation-wrapper"> <div class="half-block"> <h2>Navigation</h2> <nav> <ul class="primary-nav"> <li><a href="/">Home</a></li> <li><a href="/about">About</a></li> <li><a href="/docs">Documentation Notes</a></li> <li><a href="/pyangbind">PyangBind Documentation</a></li> <li><a href="https://github.com/robshakir/pynms" target="_blank"><i class="icon icon-github"></i> GitHub</a></li> <!--<li><a href="http://twitter.com/robshakir" target="_blank"><i class="icon icon-twitter"></i> Twitter</a></li>--> <!-- <li><a href="/feed.xml" target="_blank"><i class="icon icon-feed"></i> RSS</a></li>--> </ul> </nav> </div> </div> </div> </header> <article class="post" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header intro"> <div> <h1 class="post-title" itemprop="name headline"><span class="controlled-title">PyangBind: Getting Started</span></h1> </div> <div class="zone"> <span class="naviitem"><a class="naviitem" href="/pyangbind/">Overview</a></span> <span class="naviitem"><a class="naviitem" href="/pyangbind/getting_started">Getting Started</a></span> <span class="naviitem"><a class="naviitem" href="/pyangbind/usage">Usage</a></span> <span class="naviitem"><a class="naviitem" href="/pyangbind/generic_methods">Generic Methods</a></span> <span class="naviitem"><a class="naviitem" href="/errors">Errors</a></span> <span class="naviitem"><a class="naviitem" href="/serialisation">Serialisation</a></span> <span class="naviitem"><a class="naviitem" href="/xpath">XPATH</a></span> <span class="naviitem"><a class="naviitem" href="/extmethods">Extension Methods</a></span> <span class="naviitem"><a class="naviitem" href="/rpc">RPCs</a></span> <span class="naviitem"><a class="naviitem" href="/yang">YANG Mapping</a></span> </div> </header> <div class="post-content container" itemprop="articleBody"> <p><strong>PyangBind</strong> is a plugin for <a href="https://github.com/mbj4668/pyang">Pyang</a> that generates a Python class hierarchy from a YANG data model. The resulting classes can be directly interacted with in Python. Particularly, <strong>PyangBind</strong> will allow you to:</p> <ul> <li>Create new data instances - through setting values in the Python class hierarchy.</li> <li>Load data instances from external sources - taking input data from an external source and allowing it to be addressed through the Python classes.</li> <li>Serialise populated objects into formats that can be stored, or sent to another system (e.g., a network element).</li> </ul> <p>Development of <strong>PyangBind</strong> has been motivated by consuming the <a href="http://www.openconfig.net/">OpenConfig</a> data models; and is intended to be well-tested against these models. The Python classes generated, and serialisation methods are intended to provide network operators with a starting point for loading data instances from network elements, manipulating them, and sending them to a network device. <strong>PyangBind</strong> classes also have functionality which allows additional methods to be associated with the classes, such that it can be used for the foundation of a NMS.</p> <hr /> <h2 id="contents">Contents</h2> <ul> <li><a href="#getting-started">Getting Started</a> <ul> <li><a href="#generating-classes">Generating a Set of Classes</a></li> <li><a href="#using-in-python">Using the Classes in a Python Program</a></li> <li><a href="#create-instance">Creating a Data Instance</a></li> <li><a href="#serialising">Serialising a Data Instance</a></li> <li><a href="#deserialising">Deserialising a Data Instance to Classes</a></li> <li><a href="#example-code">Example Code</a></li> </ul> </li> <li><a href="#documentation">Further Documentation</a></li> <li><a href="#licensing">Licensing</a></li> <li><a href="#acks">Acknowledgements</a></li> </ul> <hr /> <h2 id="getting-started-a-namegetting-starteda">Getting Started <a name="getting-started"></a></h2> <p><strong>PyangBind</strong> is distributed through <a href="http://pypi.python.org">PyPI</a>, it can be installed by simply running:</p><pre><code>$ pip install pyangbind
</code></pre><p>The <code>pyangbind</code> module installs both the Pyang plugin (<code>pyangbind.plugin.*</code>), as well as a set of library modules (<code>pyangbind.lib.*</code>) that are used to provide the Python representation of YANG types.</p> <h3 id="generating-a-set-of-classes-a-namegenerating-classesa">Generating a Set of Classes <a name="generating-classes"></a></h3> <p>To generate your first set of classes, you will need a YANG module, and its dependencies. A number of simple modules can be found in the <code>tests</code> directory (e.g., <code>tests/base-test.yang</code>).</p> <p>To generate a set of Python classes, Pyang needs to be provided a pointer to where PyangBind’s plugin is installed. This location can be found by running:</p><pre><code>$  export PYBINDPLUGIN=`/usr/bin/env python -c \
	'import pyangbind; import os; print "%s/plugin" % os.path.dirname(pyangbind.__file__)'`
$ echo $PYBINDPLUGIN
</code></pre><p>Once this path is known, it can be provided to the <code>--plugin-dir</code> argument to Pyang. In the simplest form the command used is:</p><pre><code>$ pyang --plugindir $PYBINDPLUGIN -f pybind -o binding.py tests/base-test.yang
</code></pre><p>where:</p> <ul> <li><code>$PYBINDPLUGIN</code> is the location that was exported from the above command.</li> <li><code>binding.py</code> is the desired output file.</li> <li><code>doc/base-test.yang</code> is the path to the YANG module that bindings are to be generated for.</li> </ul> <p>There are a number of other options for <strong>PyangBind</strong>, which are discussed further in the <code>docs/</code> directory.</p> <hr /> <h3 id="using-the-classes-in-a-python-program-a-nameusing-in-pythona">Using the Classes in a Python Program <a name="using-in-python"></a></h3> <p><strong>PyangBind</strong> generates a (set of) Python modules. The top level module is named after the YANG module - with the name made Python safe. In general this appends underscores to reserved names, and replaces hyphens with underscores - such that <code>openconfig-local-routing.yang</code> becomes <code>openconfig_local_routing</code> as a module name.</p> <p>Primarily, we need to generate a set of classes for the model(s) that we are interested in. The OpenConfig local routing module will be used as an example for this walkthrough.</p> <p>The bindings can be simply generated by running the <code>doc/example/oc-local-routing/generate_bindings.sh</code> script. This script simply uses <code>curl</code> to retrieve the modules, and subsequently, builds the bindings to a <code>binding.py</code> file as expressed above.</p> <p>The simplest program using a PyangBind set of classes will look like:</p> <div class="highlighter-coderay"><div class="CodeRay"> <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span><span style="color:#777"># Using the binding file generated by the `generate_bindings.sh` script</span>
<span class="line-numbers"><a href="#n2" name="n2">2</a></span><span style="color:#777"># Note that CWD is the file containing the binding.py file.</span>
<span class="line-numbers"><a href="#n3" name="n3">3</a></span><span style="color:#777"># Alternatively, you can use sys.path.append to add the CWD to the PYTHONPATH</span>
<span class="line-numbers"><a href="#n4" name="n4">4</a></span><span style="color:#080;font-weight:bold">from</span> <span style="color:#B44;font-weight:bold">binding</span> <span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">openconfig_local_routing</span>
<span class="line-numbers"><a href="#n5" name="n5">5</a></span>
<span class="line-numbers"><a href="#n6" name="n6">6</a></span>oclr = openconfig_local_routing()
</pre></div> </div> </div> <hr /> <h3 id="creating-a-data-instance-a-namecreate-instancea">Creating a Data Instance <a name="create-instance"></a></h3> <p>At this point, the <code>oclr</code> object can be used to manipulate the YANG data tree that is expressed by the module.</p> <p>A subset of <code>openconfig-local-routing</code> looks like the following tree:</p><pre><code>module: openconfig-local-routing
   +--rw local-routes
   ...
      +--rw static-routes
      |  +--rw static* [prefix]
      |     +--rw prefix    -&gt; ../config/prefix
      |     +--rw config
      |     |  +--rw prefix?     inet:ip-prefix
      |     |  +--rw next-hop*   union
</code></pre><p>To add an entry to the <code>static</code> list the <code>add</code> method of the <code>static</code> object is used:</p> <div class="highlighter-coderay"><div class="CodeRay"> <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span>rt = oclr.local_routes.static_routes.static.add(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">192.0.2.1/32</span><span style="color:#710">&quot;</span></span>)
</pre></div> </div> </div> <p>The <code>static</code> list is addressed exactly as per the path that it has within the YANG module - such that it is a member of the <code>static-routes</code> container (whose name has been made Python-safe), which itself is a member of the <code>local-routes</code> container.</p> <p>The <code>add</code> method returns a reference to the newly created list object - such that we can use the <code>rt</code> object to change characteristics of the newly created list entry. For example, a tag can be set on the route:</p> <div class="highlighter-coderay"><div class="CodeRay"> <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span>rt.config.set_tag = <span style="color:#00D">42</span>
</pre></div> </div> </div> <p>The tag value can then be accessed directly via the <code>rt</code> object, or via the original <code>oclr</code> object (which both refer to the same object in memory):</p> <div class="highlighter-coderay"><div class="CodeRay"> <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span><span style="color:#777"># Retrieve the tag value</span>
<span class="line-numbers"><a href="#n2" name="n2">2</a></span>print(rt.config.set_tag)
<span class="line-numbers"><a href="#n3" name="n3">3</a></span><span style="color:#777"># output: 42</span>
<span class="line-numbers"><a href="#n4" name="n4">4</a></span>
<span class="line-numbers"><a href="#n5" name="n5">5</a></span><span style="color:#777"># Retrieve the tag value through the original object</span>
<span class="line-numbers"><a href="#n6" name="n6">6</a></span>print(oclr.local_routes.static_routes.static[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">192.0.2.1/32</span><span style="color:#710">&quot;</span></span>].config.set_tag)
<span class="line-numbers"><a href="#n7" name="n7">7</a></span><span style="color:#777"># output: 42</span>
</pre></div> </div> </div> <p>In addition, PyangBind classes which represent <code>container</code> or <code>list</code> objects have a special <code>get()</code> method. This dumps a dictionary representation of the object for printing or debug purposes (see the sections on serialisation for outputting data instances for interaction with other devices). For example:</p> <div class="highlighter-coderay"><div class="CodeRay"> <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span>print(oclr.local_routes.static_routes.static[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">192.0.2.1/32</span><span style="color:#710">&quot;</span></span>].get(filter=<span style="color:#069">True</span>))
<span class="line-numbers"><a href="#n2" name="n2">2</a></span><span style="color:#777"># returns {'prefix': u'192.0.2.1/32', 'config': {'set-tag': 42}}</span>
</pre></div> </div> </div> <p>The <code>filter</code> keyword allows only the elements within the class that have changed (are not empty or their default) to be output - rather than all possible elements.</p> <p>Since the <code>next-hop</code> element in this model is a <code>leaf-list</code> this acts like a Python list, albeit one that validates the contents that are put into it. For example, the <code>append</code> method can be used to add entries to the list, which can be iterated through using a standard Python loop:</p> <div class="highlighter-coderay"><div class="CodeRay"> <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span><span style="color:#777"># Add a next-hop</span>
<span class="line-numbers"><a href="#n2" name="n2">2</a></span>rt.config.next_hop.append(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">10.0.0.1</span><span style="color:#710">&quot;</span></span>)
<span class="line-numbers"><a href="#n3" name="n3">3</a></span>rt.config.next_hop.append(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">192.168.207.1</span><span style="color:#710">&quot;</span></span>)
<span class="line-numbers"><a href="#n4" name="n4">4</a></span>
<span class="line-numbers"><a href="#n5" name="n5">5</a></span><span style="color:#777"># Iterate through the next-hops added</span>
<span class="line-numbers"><a href="#n6" name="n6">6</a></span><span style="color:#080;font-weight:bold">for</span> nh <span style="color:#080;font-weight:bold">in</span> rt.config.next_hop:
<span class="line-numbers"><a href="#n7" name="n7">7</a></span>  print(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">%d: %s</span><span style="color:#710">&quot;</span></span> % (rt.config.next_hop.index(nh), nh))
</pre></div> </div> </div> <p>Where (type or value) restrictions exist. PyangBind generated classes will result in a Python <code>ValueError</code> being raised. For example, if we attempt to set the <code>set_tag</code> leaf to an invalid value:</p> <div class="highlighter-coderay"><div class="CodeRay"> <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span><span style="color:#777"># Try and set an invalid tag type</span>
<span class="line-numbers"><a href="#n2" name="n2">2</a></span><span style="color:#080;font-weight:bold">try</span>:
<span class="line-numbers"><a href="#n3" name="n3">3</a></span>  rt.config.set_tag = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">INVALID-TAG</span><span style="color:#710">&quot;</span></span>
<span class="line-numbers"><a href="#n4" name="n4">4</a></span><span style="color:#080;font-weight:bold">except</span> <span style="color:#C00;font-weight:bold">ValueError</span> <span style="color:#080;font-weight:bold">as</span> m:
<span class="line-numbers"><a href="#n5" name="n5">5</a></span>  print(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Cannot set tag: %s</span><span style="color:#710">&quot;</span></span> % m)
</pre></div> </div> </div> <hr /> <h3 id="serialising-a-data-instance-a-nameserialisinga">Serialising a Data Instance <a name="serialising"></a></h3> <p>Clearly, populated PyangBind classes are not useful in and of themselves - the common use case is that they are sent to a external system (e.g., a router, or other NMS component). To achieve this the class hierarchy needs to be serialised into a format that can be sent to the remote entity. There are currently multiple ways to do this:</p> <ul> <li><strong>XML</strong> - the rules for this mapping are defined in <a href="https://tools.ietf.org/html/draft-ietf-netmod-rfc6020bis-11">RFC6020bis</a> - currently <em>NOT SUPPORTED</em>.</li> <li><strong>OpenConfig-suggested JSON</strong> - the rules for this mapping are currently being written into a formal specification. This is the standard (<code>default</code>) format used by PyangBind. Some network equipment vendors utilise this serialisation format.</li> <li><strong>IETF JSON</strong> - the rules for this mapping are defined in <a href="https://tools.ietf.org/html/draft-ietf-netmod-yang-json-09">draft-ietf-netmod-yang-json</a> - some network equipment vendors use this format.</li> </ul> <p>Any PyangBind class can be serialised into any of the supported formats. Using the static route example above, the entire <code>local-routing</code> module can be serialised into OC-JSON using the following code:</p> <div class="highlighter-coderay"><div class="CodeRay"> <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">pyangbind.lib.pybindJSON</span> <span style="color:#080;font-weight:bold">as</span> pybindJSON
<span class="line-numbers"><a href="#n2" name="n2">2</a></span><span style="color:#777"># Dump the entire instance as JSON in PyangBind format</span>
<span class="line-numbers"><a href="#n3" name="n3">3</a></span>print(pybindJSON.dumps(oclr))
</pre></div> </div> </div> <p>This outputs the following JSON structured text:</p> <div class="highlighter-coderay"><div class="CodeRay"> <div class="code"><pre><span class="line-numbers"> <a href="#n1" name="n1">1</a></span>{
<span class="line-numbers"> <a href="#n2" name="n2">2</a></span>    <span style="color:#606"><span style="color:#404">&quot;</span><span>local-routes</span><span style="color:#404">&quot;</span></span>: {
<span class="line-numbers"> <a href="#n3" name="n3">3</a></span>        <span style="color:#606"><span style="color:#404">&quot;</span><span>static-routes</span><span style="color:#404">&quot;</span></span>: {
<span class="line-numbers"> <a href="#n4" name="n4">4</a></span>            <span style="color:#606"><span style="color:#404">&quot;</span><span>static</span><span style="color:#404">&quot;</span></span>: {
<span class="line-numbers"> <a href="#n5" name="n5">5</a></span>                <span style="color:#606"><span style="color:#404">&quot;</span><span>192.0.2.1/32</span><span style="color:#404">&quot;</span></span>: {
<span class="line-numbers"> <a href="#n6" name="n6">6</a></span>                    <span style="color:#606"><span style="color:#404">&quot;</span><span>prefix</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">192.0.2.1/32</span><span style="color:#710">&quot;</span></span>,
<span class="line-numbers"> <a href="#n7" name="n7">7</a></span>                    <span style="color:#606"><span style="color:#404">&quot;</span><span>config</span><span style="color:#404">&quot;</span></span>: {
<span class="line-numbers"> <a href="#n8" name="n8">8</a></span>                        <span style="color:#606"><span style="color:#404">&quot;</span><span>set-tag</span><span style="color:#404">&quot;</span></span>: <span style="color:#00D">42</span>,
<span class="line-numbers"> <a href="#n9" name="n9">9</a></span>                        <span style="color:#606"><span style="color:#404">&quot;</span><span>next-hop</span><span style="color:#404">&quot;</span></span>: [
<span class="line-numbers"><strong><a href="#n10" name="n10">10</a></strong></span>                            <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">10.0.0.1</span><span style="color:#710">&quot;</span></span>,
<span class="line-numbers"><a href="#n11" name="n11">11</a></span>                            <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">192.168.207.1</span><span style="color:#710">&quot;</span></span>
<span class="line-numbers"><a href="#n12" name="n12">12</a></span>                        ]
<span class="line-numbers"><a href="#n13" name="n13">13</a></span>                    }
<span class="line-numbers"><a href="#n14" name="n14">14</a></span>                }
<span class="line-numbers"><a href="#n15" name="n15">15</a></span>            }
<span class="line-numbers"><a href="#n16" name="n16">16</a></span>        }
<span class="line-numbers"><a href="#n17" name="n17">17</a></span>    }
<span class="line-numbers"><a href="#n18" name="n18">18</a></span>}
</pre></div> </div> </div> <p>Note here that the <code>static</code> list is represented as a JSON object (such that if this JSON is loaded elsewhere, a prefix can be referenced using <code>obj["local-routes"]["static-routes"]["static"]["192.0.2.1/32"]</code>).</p> <p>It is also possible to serialise a subset of the data, e.g., only one <code>list</code> or <code>container</code> within the class hierarchy. This is done as follows (into IETF-JSON):</p><pre><code># Dump the static routes instance as JSON in IETF format
print(pybindJSON.dumps(oclr.local_routes, mode="ietf"))
</code></pre><p>And the corresponding output:</p> <div class="highlighter-coderay"><div class="CodeRay"> <div class="code"><pre><span class="line-numbers"> <a href="#n1" name="n1">1</a></span>{
<span class="line-numbers"> <a href="#n2" name="n2">2</a></span>    <span style="color:#606"><span style="color:#404">&quot;</span><span>openconfig-local-routing:static-routes</span><span style="color:#404">&quot;</span></span>: {
<span class="line-numbers"> <a href="#n3" name="n3">3</a></span>        <span style="color:#606"><span style="color:#404">&quot;</span><span>static</span><span style="color:#404">&quot;</span></span>: [
<span class="line-numbers"> <a href="#n4" name="n4">4</a></span>            {
<span class="line-numbers"> <a href="#n5" name="n5">5</a></span>                <span style="color:#606"><span style="color:#404">&quot;</span><span>prefix</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">192.0.2.1/32</span><span style="color:#710">&quot;</span></span>,
<span class="line-numbers"> <a href="#n6" name="n6">6</a></span>                <span style="color:#606"><span style="color:#404">&quot;</span><span>config</span><span style="color:#404">&quot;</span></span>: {
<span class="line-numbers"> <a href="#n7" name="n7">7</a></span>                    <span style="color:#606"><span style="color:#404">&quot;</span><span>set-tag</span><span style="color:#404">&quot;</span></span>: <span style="color:#00D">42</span>,
<span class="line-numbers"> <a href="#n8" name="n8">8</a></span>                    <span style="color:#606"><span style="color:#404">&quot;</span><span>next-hop</span><span style="color:#404">&quot;</span></span>: [
<span class="line-numbers"> <a href="#n9" name="n9">9</a></span>                        <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">10.0.0.1</span><span style="color:#710">&quot;</span></span>,
<span class="line-numbers"><strong><a href="#n10" name="n10">10</a></strong></span>                        <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">192.168.207.1</span><span style="color:#710">&quot;</span></span>
<span class="line-numbers"><a href="#n11" name="n11">11</a></span>                    ]
<span class="line-numbers"><a href="#n12" name="n12">12</a></span>                }
<span class="line-numbers"><a href="#n13" name="n13">13</a></span>            }
<span class="line-numbers"><a href="#n14" name="n14">14</a></span>        ]
<span class="line-numbers"><a href="#n15" name="n15">15</a></span>    }
<span class="line-numbers"><a href="#n16" name="n16">16</a></span>}
</pre></div> </div> </div> <p>Here, note that the list is represented as a JSON array, as per the IETF specification; and that only the <code>static-routes</code> children of the object have been serialised.</p> <h3 id="deserialising-a-data-instance-a-namedeserialisinga">Deserialising a Data Instance <a name="deserialising"></a></h3> <p>PyangBind also supports taking data instances from a remote system (or locally saved documents) and loading them into either a new, or existing set of classes. This is useful for when a remote system sends a data instance in response to a query - and the programmer wishes to injest this response such that further logic can be performed based on it.</p> <p>Instances can be deserialised from any of the supported serialisation formats (see above) into the classes.</p> <p>To de-serialise into a new object, the <code>load</code> method of the serialise module can be used:</p> <div class="highlighter-coderay"><div class="CodeRay"> <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span>new_oclr = pybindJSON.load(os.path.join(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">json</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">oc-lr.json</span><span style="color:#710">&quot;</span></span>), binding, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">openconfig_local_routing</span><span style="color:#710">&quot;</span></span>)
</pre></div> </div> </div> <p>This creates a new instance of the <code>openconfig_local_routing</code> class that is within the <code>binding</code> module, and loads the data from <code>json/oc-lr.json</code> into it. The <code>new_oclr</code> object can then be manipulated as per any other class:</p> <div class="highlighter-coderay"><div class="CodeRay"> <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span><span style="color:#777"># Manipulate the data loaded</span>
<span class="line-numbers"><a href="#n2" name="n2">2</a></span>print(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Current tag: %d</span><span style="color:#710">&quot;</span></span> % new_oclr.local_routes.static_routes.static[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#E40">u</span><span style="color:#710">&quot;</span><span style="color:#D20">192.0.2.1/32</span><span style="color:#710">&quot;</span></span>].config.set_tag)
<span class="line-numbers"><a href="#n3" name="n3">3</a></span><span style="color:#777"># Outputs: 'Current tag: 42'</span>
<span class="line-numbers"><a href="#n4" name="n4">4</a></span>
<span class="line-numbers"><a href="#n5" name="n5">5</a></span>new_oclr.local_routes.static_routes.static[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#E40">u</span><span style="color:#710">&quot;</span><span style="color:#D20">192.0.2.1/32</span><span style="color:#710">&quot;</span></span>].config.set_tag += <span style="color:#00D">1</span>
<span class="line-numbers"><a href="#n6" name="n6">6</a></span>print(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">New tag: %d</span><span style="color:#710">&quot;</span></span> % new_oclr.local_routes.static_routes.static[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#E40">u</span><span style="color:#710">&quot;</span><span style="color:#D20">192.0.2.1/32</span><span style="color:#710">&quot;</span></span>].config.set_tag)
<span class="line-numbers"><a href="#n7" name="n7">7</a></span><span style="color:#777"># Outputs: 'Current tag: 43'</span>
</pre></div> </div> </div> <p>Equally, a JSON instance can be loaded into an existing set of classes - this is done by directly calling the relevant deserialisation class – in this case <code>pybindJSONDecoder</code>:</p> <div class="highlighter-coderay"><div class="CodeRay"> <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span><span style="color:#777"># Load JSON into an existing class structure</span>
<span class="line-numbers"><a href="#n2" name="n2">2</a></span><span style="color:#080;font-weight:bold">from</span> <span style="color:#B44;font-weight:bold">pyangbind.lib.serialise</span> <span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">pybindJSONDecoder</span>
<span class="line-numbers"><a href="#n3" name="n3">3</a></span><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">json</span>
<span class="line-numbers"><a href="#n4" name="n4">4</a></span>
<span class="line-numbers"><a href="#n5" name="n5">5</a></span>ietf_json = json.load(<span style="color:#369;font-weight:bold">open</span>(os.path.join(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">json</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">oc-lr_ietf.json</span><span style="color:#710">&quot;</span></span>), <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">r</span><span style="color:#710">'</span></span>))
<span class="line-numbers"><a href="#n6" name="n6">6</a></span>pybindJSONDecoder.load_ietf_json(ietf_json, <span style="color:#069">None</span>, <span style="color:#069">None</span>, obj=new_oclr.local_routes)
</pre></div> </div> </div> <p>The direct <code>load_ietf_json</code> method is handed a JSON object - and no longer requires the arguments for the module and class name (hence they are both set to <code>None</code>), rather the optional <code>obj=</code> argument is used to specify the object that corresponds to the JSON that is being loaded.</p> <p>Following this load, the classes can be iterated through - showing both the original loaded route (<code>192.0.2.1/32</code>) and the one in the IETF JSON encoded file (<code>192.0.2.2/32</code>) exist in the data instance:</p> <div class="highlighter-coderay"><div class="CodeRay"> <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span><span style="color:#777"># Iterate through the classes - both the 192.0.2.1/32 prefix and 192.0.2.2/32</span>
<span class="line-numbers"><a href="#n2" name="n2">2</a></span><span style="color:#777"># prefix are now in the objects</span>
<span class="line-numbers"><a href="#n3" name="n3">3</a></span><span style="color:#080;font-weight:bold">for</span> prefix, route <span style="color:#080;font-weight:bold">in</span> new_oclr.local_routes.static_routes.static.iteritems():
<span class="line-numbers"><a href="#n4" name="n4">4</a></span>  print(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Prefix: %s, tag: %d</span><span style="color:#710">&quot;</span></span> % (prefix, route.config.set_tag))
<span class="line-numbers"><a href="#n5" name="n5">5</a></span>
<span class="line-numbers"><a href="#n6" name="n6">6</a></span><span style="color:#777"># Output:</span>
<span class="line-numbers"><a href="#n7" name="n7">7</a></span><span style="color:#777">#                Prefix: 192.0.2.2/32, tag: 256</span>
<span class="line-numbers"><a href="#n8" name="n8">8</a></span><span style="color:#777">#                Prefix: 192.0.2.1/32, tag: 43</span>
</pre></div> </div> </div> <hr /> <h3 id="example-code-a-nameexample-codea">Example Code <a name="example-code"></a></h3> <p>This worked example can be found in the <code>docs/example/oc-local-routing</code> directory on <a href="https://github.com/robshakir/pyangbind">GitHub</a></p> <hr /> <h2 id="licensing-a-namelicensinga">Licensing <a name="licensing"></a></h2><pre><code>Copyright 2015, Rob Shakir (rjs@rob.sh)

This project has been supported by:
          * Jive Communications, Inc.
          * BT plc.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
</code></pre><hr /> <h2 id="acknowledgements-a-nameacksa">Acknowledgements <a name="acks"></a></h2> <ul> <li>This project was initiated as part of BT plc. Network Architecture ‘future network management’ projects.</li> <li>Ongoing development and support for this project is supported by <a href="www.jive.com">Jive Communications, Inc</a>.</li> <li>Members of the <a href="http://www.openconfig.net">OpenConfig</a> working group have assisted greatly in debugging, and designing a number of the approaches used in PyangBind.</li> <li>Thanks to folks from Juniper Networks for their views on Python mapping, and examples that are included as part of the PyangBind unit tests.</li> </ul> </div> </article> <footer class="site-footer"> <div class="container"> <ul class="social"> <li><a href="https://github.com/robshakir" target="_blank"><i class="icon icon-github"></i></a></li> <li><a href="http://uk.linkedin.com/in/robjs" target="_blank"><i class="icon icon-linkedin"></i></a></li> <li><a href="http://twitter.com/robshakir" target="_blank"><i class="icon icon-twitter"></i></a></li> </ul> <p> <small>&copy;2016 All rights reserved. Made with <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> and ♥</small> </p> </div> </footer> </main> <script src="/assets/js/jquery-2.1.1.js"></script> <script src="/assets/js/main.js"></script> </body> </html><!-- by nandomoreira.me -->